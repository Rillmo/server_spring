<!DOCTYPE html>
<html>
<head>
    <title>회원 목록 조회</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css"> <!-- 외부 스타일 시트 연결 -->
</head>
<body>
<h1>회원 목록 조회</h1>

<table>
    <thead>
    <tr>
        <th>이메일</th>
        <th>성</th>
        <th>이름</th>
    </tr>
    </thead>
    <tbody id="memberTable">
    <!-- API 응답 데이터는 이 곳에 동적으로 추가됩니다. -->
    </tbody>
</table>

<script>

    // JWT 토큰을 가져옵니다.
    const jwtToken = document.cookie;

    // API 엔드포인트 설정 (실제 엔드포인트로 변경해야 합니다).
    const apiUrl = 'http://localhost:8000/members';

    // HTTP 요청 헤더에 JWT 토큰을 추가합니다.
    const headers = {
        Authorization: `Bearer ${jwtToken}` // Bearer 스킴과 함께 토큰을 추가합니다.
    };

    // 요청을 보낼 URL 및 다른 요청 구성을 정의합니다.
    const requestOptions = {
        method: "GET", // HTTP 메서드 설정 (GET, POST, 등)
        headers: headers // 위에서 설정한 헤더 추가
    };

    // Fetch API를 사용하여 회원 정보를 가져오는 함수.
    function fetchMembers() {
        // JWT 토큰이 존재하는 경우에만 요청을 보냅니다.
        if (jwtToken) {
            fetch(apiUrl, requestOptions)
            .then(response => {
                if (response.status === 200) {
                    // 요청이 성공하면 응답을 처리합니다.
                    return response.json();
                } else {
                    // 요청이 실패하면 오류 처리를 수행합니다.
                    throw new Error("Request failed");
                }
            })
            .then(response => response.json()) // JSON 형식으로 응답을 파싱합니다.
            .then(data => {
                const memberTable = document.getElementById('memberTable');
                // API 응답 데이터를 테이블에 추가합니다.
                data.forEach((memberListResponse) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${memberListResponse.email}</td>
                        <td>${memberListResponse.lastName}</td>
                        <td>${memberListResponse.firstName}</td>
                    `;
                    memberTable.appendChild(row);
                });
            })
            .catch(error => {
                console.error('API 호출 중 오류 발생:', error);
            });
        }
    }

    // 페이지 로드 시 회원 정보를 가져오도록 호출합니다.
    fetchMembers();
</script>

</body>
</html>
